# 添加 nuget 包

dotnet add package dnsclient
dotnet add package Consul

# 修改 UserService.cs

# 问题

我现在有一个问题哈，User.API ConsulRegistrationService.cs 注册服务到 consul 的时候 你看代码我注册服务用的是 https， 然而在 User.Identity 工程中 UserService.cs 做服务发现的时候，service.Service.Tags 这里用 tags 的时候是空数据，导致 Scheme 是 http 了，这是什么情况呢

# 方案

```
var registration = new AgentServiceRegistration
{
    ID = serviceId,
    Name = _consulConfig.ServerName,
    Address = host,
    Port = port,
    // 添加HTTPS标签
    Tags = _consulConfig.UseHttps ? new[] { "https" } : Array.Empty<string>(),
    Check = new AgentServiceCheck
    {
        HTTP = $"{scheme}://{host}:{port}/HealthCheck",
        Interval = TimeSpan.FromSeconds(10),
        Timeout = TimeSpan.FromSeconds(5),
        DeregisterCriticalServiceAfter = TimeSpan.FromSeconds(30)
    }
};
```

Consul 本身不提供优先级机制，但返回的服务列表是随机排序的（默认轮询负载均衡）
